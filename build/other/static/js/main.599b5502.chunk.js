(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,n,t){e.exports=t(22)},18:function(e,n,t){},20:function(e,n,t){},22:function(e,n,t){"use strict";t.r(n);var r=t(0),u=t.n(r),a=t(5),s=t.n(a),c=(t(18),t(1)),i=t(6),o=t(7),f=t(11),m=t(8),b=t(12),p=(t(20),t(9).a.bind(u.a.createElement)),g=t(3);function l(){var e=Object(c.a)(["<"," ...",' key="1" />']);return l=function(){return e},e}function d(){var e=Object(c.a)(["<"," ...",' key="2" />']);return d=function(){return e},e}function v(){var e=Object(c.a)(["\n    ","\n  "]);return v=function(){return e},e}function j(){var e=Object(c.a)(['\n    <div className="message">\n      <em>',':</em>\n      <img src="','" />\n    </div>\n  ']);return j=function(){return e},e}function O(){var e=Object(c.a)(['\n    <div className="message">\n      <em>',":</em>\n      <p>","</p>\n    </div>\n  "]);return O=function(){return e},e}var y,E=function(e){return p(O(),e.message.user,e.message.message)},S=function(e){return p(j(),e.message.user,e.message.imageBase64)},T=function(e){return p(v(),"image"===e.message.type?p(d(),S,e):p(l(),E,e))},w="WAIT",h="TYPE",k=t(2),A=t(10),M=[],I=[],D={MESSAGE:"message",TYPE:"typing",WAIT:"wait",IMAGE:"image"},G="messages";function B(e,n){I.filter(function(n){return n.type===e}).forEach(function(e){return e.announce(n)})}var N=(y={},Object(k.a)(y,D.WAIT,function(e){B(G,M)}),Object(k.a)(y,D.TYPE,function(e){var n=M.concat([{user:e.data.user,message:"...is typing.",type:"announcement"}]);B(G,n)}),Object(k.a)(y,D.MESSAGE,function(e){M.push(e.data.message.reduce(function(e,n){return"imageBase64"===n[0]?e:(e[n[0]]=n[1],e)},{ts:Date.now(),type:"message"})),B(G,M)}),Object(k.a)(y,D.IMAGE,function(e){var n=Object(A.a)({},e.data.message,{ts:Date.now(),type:"image"});M.push(n),B(G,M)}),y),R={postMessage:function(e){N[e.data.cmd](e)},subscribe:function(e,n,t){var r=I.length;return I.push({type:e,announce:n,user:t}),{unsubscribe:function(){I.splice(r,1,{type:"unsubscribed"})}}}};function P(){var e=Object(c.a)(['\n    <form onSubmit="','">\n      <input type="hidden" name="user" value="','" />\n      <input\n        required\n        name="message"\n        ref="','"\n        onKeyDown="','"\n        onBlur="','"\n      />\n      <input\n        className="input__file"\n        type="file"\n        accept="image/png"\n        ref="','"\n        onChange="','"\n      />\n      <button\n        type="button"\n        onClick="','"\n      >File</button>\n      <button\n        type="submit"\n      >Send</button>\n    </form>\n  ']);return P=function(){return e},e}var Y=function(e){var n=Object(r.useState)(w),t=Object(g.a)(n,2),u=t[0],a=t[1],s=Object(r.useState)(),c=Object(g.a)(s,2),i=c[0],o=c[1],f=Object(r.useRef)(null),m=Object(r.useRef)(null);return Object(r.useEffect)(function(){R.postMessage({data:{cmd:D[u],user:e.user}})},[u]),p(P(),function(e){return function(e,n){var t=n.worker,r=n.inputEl,u=n.interfaceSend;e.preventDefault(),e.target.checkValidity()&&(u(w),t.postMessage({data:{cmd:D.MESSAGE,message:Array.from(new FormData(e.target))}}),r.current.value="")}(e,{worker:R,inputEl:m,interfaceSend:a})},e.user,m,function(n){return function(e,n){var t=n.typingTimer,r=n.setTypingTimer,u=n.interfaceSend;n.setMessageText,n.user;clearTimeout(t),u(h),r(setTimeout(u,2e3,w))}(0,{typingTimer:i,setTypingTimer:o,interfaceSend:a,inputEl:m,user:e.user})},function(e){clearTimeout(i),a(w)},f,function(n){return function(e,n){var t=n.worker,r=n.fileEl,u=n.interfaceSend,a=n.user;if(""!==e.target.value){var s=new FileReader;s.onloadend=function(e){var n=s.result;u(w),t.postMessage({data:{cmd:D.IMAGE,message:{imageBase64:n,user:a}}}),r.current.value=""},s.readAsDataURL(e.target.files[0])}}(n,{worker:R,fileEl:f,interfaceSend:a,user:e.user})},function(e){return f.current.click()})};function C(){var e=Object(c.a)(["\n    <section>\n      <h1>Hi, ",'!</h1>\n      <div className="messages">\n        ',"\n      </div>\n      <",' user="','" />\n    </section>\n  ']);return C=function(){return e},e}function F(){var e=Object(c.a)(["\n  <",' message="','" key="','" />\n']);return F=function(){return e},e}var W=function(e,n){return p(F(),T,e,n)},x=function(e){var n=Object(r.useState)([]),t=Object(g.a)(n,2),u=t[0],a=t[1];return Object(r.useEffect)(function(){var n=R.subscribe(G,a,e.user);return function(){n.unsubscribe()}}),console.log(u),p(C(),e.user,u.filter(function(n){return"announcement"!==n.type||n.user!==e.user}).map(W),Y,e.user)};function J(){var e=Object(c.a)(['\n      <div className="app">\n        <',' user="Laura" messages="','" />\n        <',' user="Rob" messages="','" />\n      </div>\n    ']);return J=function(){return e},e}var L=function(e){function n(){return Object(i.a)(this,n),Object(f.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(o.a)(n,[{key:"render",value:function(){return p(J(),x,[{},{}],x,[{},{event:"TYPE"}])}}]),n}(r.Component);s.a.render(u.a.createElement(L,null),document.getElementById("root"))}},[[13,2,1]]]);
//# sourceMappingURL=main.599b5502.chunk.js.map